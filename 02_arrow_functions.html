<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Arrow functions</title>
    </head>
    <body>

        <h1>Arrow functions</h1>

        <h2>Less code means cleaner slides</h2>
        <ol id="puns">
            <!-- TODO Find more puns -->
            <li data-badass="Arnold" data-strength="9">I'll be back</li>
            <li data-badass="" data-strength="7">I'm here to kick ass and chew bubble gum and I'm all out of gum</li>
            <li data-badass="Will" data-strength="10">Welcome to earth</li>
            <li data-badass="Arnold" data-strength="9">Hasta la vista baby</li>
            <li data-badass="" data-strength=""></li>
            <li data-badass="" data-strength=""></li>
            <li data-badass="" data-strength=""></li>
            <li data-badass="" data-strength=""></li>
            <li data-badass="" data-strength=""></li>
            <li data-badass="" data-strength=""></li>
            <li data-badass="" data-strength=""></li>
        </ol>

        <h3>The best puns (minimal strength of 8)</h3>
        <ol id="best-puns"></ol>

        <script>

            // OLD
            const punsWithAMinimalGoodnessOf = function (goodness) {
                var punNodes, punsThatAreGoodEnough, i, len
                punNodes = Array.prototype.slice.call(document.querySelectorAll('#puns li'))
                punsThatAreGoodEnough = []
                for (i = 0, len = punNodes.length; i < len; i++) {
                    if (punNodes[i].dataset.badass && punNodes[i].dataset.strength && punNodes[i].dataset.strength|0 >= goodness) {
                        punsThatAreGoodEnough.push(punNodes[i].innerText)
                        punsThatAreGoodEnough.push({ text: punNodes[i].innerText, strength: punNodes[i].dataset.strength})
                    }
                }
                return punsThatAreGoodEnough
            }

            // NEW
            const punsWithAMinimalGoodnessOf_New = goodness =>
                Array.from(document.querySelectorAll('#puns li'))
                    .filter(({ dataset }) => dataset.badass && dataset.strength)
                    .filter(({ dataset }) => dataset.strength >= goodness)
                    .map(({ innerText, dataset }) => ({ text: innerText, strength: dataset.strength}))


            // COOL
            const $$ = selector => Array.from(document.querySelectorAll(selector))
            const punIsValid = ({ dataset }) => dataset.badass && dataset.strength
            const punIsAtLeastAsGoodAs = goodness =>
                ({ dataset }) => dataset.strength >= goodness
            const createTuple = ({ innerText, dataset }) => ({ text: innerText, strength: dataset.strength})

            const punsWithAMinimalGoodnessOf_Cool = goodness =>
                $$('#puns li')
                    .filter(punIsValid)
                    .filter(punIsAtLeastAsGoodAs(goodness))
                    .map(createTuple)


            // AWESOME
            const punsThatAreGoodEnough = goodness =>
                (carry, node) => {
                    if (punIsValid(node) && punIsAtLeastAsGoodAs(goodness)(node)) {
                        carry.push(createTuple(node))
                    }
                    return carry
                }

            const punsWithAMinimalGoodnessOf_Awesome = goodness =>
                $$('#puns li').reduce(punsThatAreGoodEnough(goodness), [])


            const punsWithAMinimalGoodnessOf_LessAwesome = goodness =>
                $$('#puns li').reduce(
                    (carry, node) => {
                        if (punIsValid(node) && punIsAtLeastAsGoodAs(goodness)(node)) {
                            carry.push(createTuple(node))
                        }
                        return carry
                    }, []
                )

            document.getElementById('best-puns').innerHTML =
                punsWithAMinimalGoodnessOf_LessAwesome(8)
                .sort(({ strengthL }, { strengthR }) => strengthL > strengthR)
                .map(pun => `<li>${pun.text} (${pun.strength}/10 points)</li>`)
                .join('')

            // TODO add an example that sorts by goodness

        </script>


        <h2>Easy to inline code helps to make code more functional</h2>
        <script>
            const add = (a, b) => a + b
            const substract = (a, b) => a - b
            const double = a => add(a, a)

            const applyAndSumTwoFunctions = (params, fn1, fn2) =>
                add(fn1(...params), fn2(...params))

            console.log(applyAndSumTwoFunctions([8, 3], add, substract))


            const applyAndSumManyFunctions = (params, funs) =>
                funs.map(fn => fn(...params))
                    .reduce(add)

            console.log(applyAndSumManyFunctions([8, 3], [add, substract, add, double, double]))
        </script>


        <h2>Arrow functions and <code>this</code></h2>
        <script>
            const autoTogglerFunction = {
                state: false,
                start: function () {
                    console.log('autoTogglerFunction started', this)
                    setInterval(event => {
                        this.state = !this.state
                        console.log(this)
                    }, 700)
                }
            }

            const autoTogglerArrowFunction = {
                state: false,
                start: () => {
                    console.log('autoTogglerArrowFunction started', this)
                    setInterval(event => {
                        this.state = !this.state
                        console.log(this)
                    }, 700)
                }
            }

            const autoTogglerMethod = {
                state: false,
                start() {
                    console.log('autoTogglerMethod started', this)
                    setInterval(event => {
                        this.state = !this.state
                        console.log(this)
                    }, 700)
                }
            }

            const autoTogglerTwoMethods = {
                state: false,
                toggle() {
                    this.state = !this.state
                    console.log(this)
                },
                start() {
                    console.log('autoTogglerTwoMethods started', this)
                    setInterval(this.toggle, 700)
                }
            }

            const autoTogglerTwoMethodsWithArrow = {
                state: false,
                toggle() {
                    this.state = !this.state
                    console.log(this)
                },
                start() {
                    console.log('autoTogglerTwoMethodsWithArrow started', this)
                    setInterval(
                        () => this.toggle(),
                        700
                    )
                }
            }
        </script>
        <ul>
            <li>autoTogglerFunction</li>
            <li>autoTogglerArrowFunction</li>
            <li>autoTogglerMethod</li>
            <li>autoTogglerTwoMethods</li>
            <li>autoTogglerTwoMethodsWithArrow</li>
        </ul>


        <h2>Arrow functions and user events</h2>
        <button id="button1">button 1 (normal function üëç)</button>
        <button id="button2">button 2 (arrow function  üëé)</button>
        <script>
            const deactivate = function () {
                console.log(this)
                this.setAttribute('disabled', 'disabled')
            }

            const deactivateWithArrowFunction = event => {
                console.log(this)
                this.setAttribute('disabled', 'disabled')
            }

            document.getElementById('button1')
                .addEventListener('click', deactivate)

            document.getElementById('button2')
                .addEventListener('click', deactivateWithArrowFunction)
        </script>

    </body>
</html>
